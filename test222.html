<html>
<head>
<script src="lib/web3.min.js"></script>
<script src="lib/ethereumjs-tx.js"></script>
<script>

/*
console.log('typeof EthJS:',               (typeof EthJS))
console.log('Object.keys(EthJS):',         Object.keys(EthJS))
console.log('typeof EthJS.Tx:',            (typeof EthJS.Tx))
console.log('typeof EthJS.RLP:',           (typeof EthJS.RLP))
console.log('typeof EthJS.Util:',          (typeof EthJS.Util))
console.log('typeof EthJS.Buffer:',        (typeof EthJS.Buffer))
console.log('typeof EthJS.Buffer.Buffer:', (typeof EthJS.Buffer.Buffer))
*/



// 8df5e36b0488212b8b296b0ee05d848623dfa2db1b194b291d6e4b6694ba591f

    web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/kp7Z0DFPGq7d3S2lIKEz"));

    const privKey     = '0x3a530bdb187e41086da7174b21e03855e2ff25031dcec9946245978c4403d31a'

    // 0x937fEbBc45628F1bB2445f3c569B6b5FF05FED9A
    const addressFrom = web3.eth.accounts.privateKeyToAccount(privKey).address
    const addressTo =   '0xC6d28b3e933db943353E9063572FeBe01e56dc3B' //'0xf19f89209Fa45C6956b1DCE18cE03e1c85557B23'


    // создаем транзакцию
    var txData = {
         from: addressFrom,
         to: addressTo,
         value:  web3.utils.toHex(web3.utils.toWei("0.001", "ether")), //new web3.utils.BN(web3.utils.toWei('1', 'ether')),
         nonce: web3.utils.toHex(4),
         gas: 200000,
         //gasLimit: web3.utils.toHex(51334),
         gasPrice: web3.utils.toHex(100), // 234567897654321
         chainId: 4
   }

   console.log("11111111111111111111111")


    // подписываем транзакцию секретным ключом
    web3.eth.accounts.signTransaction(txData, privKey)
    .then( signedTx  => {
         console.log(`messageHash: ${signedTx.messageHash}\nrawTransaction: ${signedTx.rawTransaction}`)

         // отправляем транзакцию
         web3.eth.sendSignedTransaction(signedTx.rawTransaction)
         .then( receipt => {

            console.log(`receipt: ${receipt}`)
         })
         .catch(err => console.error(err));

   })
   .catch( err => console.error("111 " + err));


console.log("2222222222222222222")










/*
    web3.eth.getTransactionCount(addressFrom).then(txCount => {


      console.log("nonce=" + txCount);

      var txData = {
          nonce: web3.utils.toHex(txCount),
          gasLimit: web3.utils.toHex(51334),
          gasPrice: web3.utils.toHex(100),
          to: addressTo,
          from: addressFrom,
          value: new web3.utils.BN(web3.utils.toWei('2', 'ether'))
      }

      console.log('Sending Transction')

      sendSigned(txData, function(err, result) {
          if (err) return console.log('error', err)

          console.log('sent', result)
    })
   })


    //
    function sendSigned(txData, cb) {

        const privateKey  = new EthJS.Buffer.Buffer(privKey, 'hex')
        const transaction = new EthJS.Tx(txData)


        //web3.eth.signTransaction(txData).then(console.log);


        transaction.sign(privateKey)

        const serializedTx = transaction.serialize().toString('hex')

        console.log("serializedTx: " + '0x' + serializedTx);

        web3.eth.sendSignedTransaction('0x' + serializedTx, function(err, hash) {
            if(err)
             console.log("Error Occured: ", err);
            else
             console.log("Hash: ", hash)

            //waitForReceipt(hash);
        })
    }
*/






/*
  let privateKey = new EthJS.Buffer.Buffer('e331b6d69882b4cb4ea581d88e0b604039a3de5967688d3dcffdd2270c0fd109', 'hex')
  let txParams = {
    nonce:    '0x00',
    gasPrice: '0x09184e72a000',
    gasLimit: '0x2710',
    to:       '0x0000000000000000000000000000000000000000',
    value:    '0x00',
    data:     '0x7f7465737432000000000000000000000000000000000000000000000000000000600057'
  }
  let tx = new EthJS.Tx(txParams)
  tx.sign(privateKey)
  let serializedTx = tx.serialize().toString('hex')

  console.log('serializedTx:', serializedTx)
*/

</script>
</head>
<body>
</body>
</html>
