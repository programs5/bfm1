<html>
<head>

<script type="text/javascript" src="lib/web3.min.js" />

<!-- <script type="text/javascript" src="lib/bn.js" /> -->
<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script> -->

<!-- https://github.com/ethereumjs/browser-builds -->
<script type="text/javascript" src="lib/ethereumjs-tx-1.3.3.js"></script>

<script type="text/javascript" src="lib/ethjs-signer.min.js"></script>



<script type="text/javascript">

    // подключаемся к ноде
    web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/kp7Z0DFPGq7d3S2lIKEz"));



   /*
   web3.eth.getBlockNumber(function(err, res) {
      if(err) {
         console.log(err);
      }
      else {
         console.log("blockNumber: " + res);
      }
   });
   */


   web3.eth.getBlockNumber().then(
      function(res){
         console.log("blockNumber: " + res);
      },
      function(err){
         console.log("getBlockNumber " + err);
      }
   );


   web3.eth.getTransaction('0x2456d62e8ae2aad6b7cd76eb60cccf8b481205a2059aa2210d2377d1ab15158b').then( res =>{

         console.log(`transaction info (0x2456d62e8ae2aad6b7cd76eb60cccf8b481205a2059aa2210d2377d1ab15158b):
            blockHash: ${res.blockHash}
            blockNumber: ${res.blockNumber}
            from: ${res.from}
            to: ${res.to}
            value: ${res.value}`
         );
      });

/*
   web3.eth.getTransaction('0x2456d62e8ae2aad6b7cd76eb60cccf8b481205a2059aa2210d2377d1ab15158b').then(
      function(res){
         console.log(`transaction info (0x2456d62e8ae2aad6b7cd76eb60cccf8b481205a2059aa2210d2377d1ab15158b):

            blockHash: ${res.blockHash}
            blockNumber: ${res.blockNumber}
            from: ${res.from}
            to: ${res.to}
            value: ${res.value}`
         );
      },
      function(err){
         console.log("getTransaction " + err);
      }
   );
*/
    const addressFrom = '0x937fEbBc45628F1bB2445f3c569B6b5FF05FED9A'
    const addressTo =   '0xf19f89209Fa45C6956b1DCE18cE03e1c85557B23'
    const privKey = '3a530bdb187e41086da7174b21e03855e2ff25031dcec9946245978c4403d31a'



    //var eth1 = web3.utils.toWei('1', 'ether');

   //console.log("WWWWWWWWWWWW " + new web3.utils.BN(eth1));

   startTran();




  // как выполнить транзакцию
  // https://ethereum.stackexchange.com/questions/44156/about-security-of-web3-js-when-running-inside-a-browser

  function sendSigned(txData, cb) {
      //const privateKey = new Buffer(privKey, 'hex')
      const privateKey = new Buffer(privKey, 'hex')

      const transaction = new Tx(txData)

      transaction.sign(privateKey)
      
      const serializedTx = transaction.serialize().toString('hex')

      // console.log("\nRaw txn: "+'0x' + serializedTx);

      web3.eth.sendSignedTransaction('0x' + serializedTx, function(err,hash) {
          if(err)
            console.log("Error Occured: ",err);
          else
            console.log("Hash: ",hash)

          waitForReceipt(hash);
      })
  }

  function startTran()
  {
    web3.eth.getTransactionCount(addressFrom).then(txCount => {

        console.log("nonce="+txCount);

        // construct the transaction data
        var txData = {
            nonce: web3.utils.toHex(txCount),
            gasLimit: web3.utils.toHex(51334),
            gasPrice: web3.utils.toHex(100),
            to: addressTo,
            from: addressFrom,
            value: new web3.utils.BN(web3.utils.toWei('1', 'ether'))  //0x10000
        }

        console.log('Sending Transction')
        // fire away!
        //console.log('Txn Number ' + i);

        sendSigned(txData, function(err, result) {
            if (err) return console.log('error', err)
            console.log('sent', result)
        })
    })
}



</script>

</head>
  <body>
    <h1>coinbase balance</h1>

<!--
    <button type="button" onClick="getAccountsBalance();">watch balance</button>
	   <button type="button" onClick="sendTransacton();">sendTran</button>

	<div></div>
    <div id="coinbase"></div>
    <div id="original"></div>
    <div id="current"></div>
    <div id="diff"></div>
	-->

  </body>
</html>
