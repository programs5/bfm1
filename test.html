<!DOCTYPE html>
<html>
<head>
<!-- <script type="text/javascript" src="lib/web3.min.js" /> -->
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>



<!-- https://github.com/ethereumjs/browser-builds -->

<!-- https://github.com/ethereumjs/browser-builds/blob/master/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js -->
<script src="../dist/ethereumjs-vm/ethereumjs-vm-2.3.1.js"></script>

<script type="text/javascript">

/////// const Tx = require('ethereumjs-tx')


    // подключаемся к ноде
    web3 = new Web3(new Web3.providers.HttpProvider("https://rinkeby.infura.io/kp7Z0DFPGq7d3S2lIKEz"));

    /* или если локальная нода geth (http://127.0.0.1:8545)

        '/Users/mac/Library/Application Support/Ethereum Wallet/binaries/Geth/unpacked/geth'
            --rinkeby --rpc --rpcapi db,eth,net,web3,personal --rpcport 8545 --rpcaddr "localhost"
            --rpccorsdomain "*" --unlock="0xc6d28b3e933db943353e9063572febe01e56dc3b"
    */

    // для проверки подключения - смотрим номер последнего блока в сети
    console.log(web3.eth.blockNumber);

    const addressFrom = '0x937fEbBc45628F1bB2445f3c569B6b5FF05FED9A'
    const privKey = '3a530bdb187e41086da7174b21e03855e2ff25031dcec9946245978c4403d31a'


  // как выполнить транзакцию
  // https://ethereum.stackexchange.com/questions/44156/about-security-of-web3-js-when-running-inside-a-browser

  function sendSigned(txData, cb) {
      const privateKey = new Buffer(privKey, 'hex')
      const transaction = new Tx(txData)

      transaction.sign(privateKey)
      const serializedTx = transaction.serialize().toString('hex')

      // console.log("\nRaw txn: "+'0x' + serializedTx);

      web3.eth.sendSignedTransaction('0x' + serializedTx, function(err,hash) {
          if(err)
            console.log("Error Occured: ",err);
          else
            console.log("Hash: ",hash)

          waitForReceipt(hash);
      })
  }

  web3.eth.getTransactionCount(addressFrom).then( txCount => {
        console.log("nonce="+txCount);
        // construct the transaction data
        var txData = {
            nonce: web3.utils.toHex(txCount),
            gasLimit: web3.utils.toHex(51334),
            gasPrice: web3.utils.toHex(100),
            to: addressTo,
            from: addressFrom,
            value: 0x10000
        }
        console.log('Sending Transction')
        // fire away!
        console.log('Txn Number '+i);

        sendSigned(txData, function(err, result) {
            if (err) return console.log('error', err)
            console.log('sent', result)
        })
    })



</script>

</head>
  <body>
    <h1>coinbase balance</h1>

<!--
    <button type="button" onClick="getAccountsBalance();">watch balance</button>
	   <button type="button" onClick="sendTransacton();">sendTran</button>

	<div></div>
    <div id="coinbase"></div>
    <div id="original"></div>
    <div id="current"></div>
    <div id="diff"></div>
	-->

  </body>
</html>
